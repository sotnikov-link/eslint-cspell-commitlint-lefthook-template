# yaml-language-server: $schema=https://json.schemastore.org/lefthook.json

# https://github.com/evilmartians/lefthook/tree/v1.5.0/examples/commitlint
commit-msg:
  commands:
    commitlint:
      run: yarn commitlint --edit {1}
    cspell:
      run: yarn check-cspell {1}

# https://github.com/evilmartians/lefthook/wiki/Migration-from-husky-with-lint-staged
pre-commit:
  parallel: true
  commands:
    eslint:
      exclude: &eslint-exclude '\.(md|html|svg|lock|gitignore|gitattributes)$'
      run: yarn check-eslint {staged_files}
    prettier:
      exclude: &yarn-lock 'yarn\.lock$|\.mdc$'
      run: yarn check-prettier {staged_files}
    cspell:
      exclude: *yarn-lock
      run: yarn check-cspell {staged_files}
    test:
      run: yarn test

pre-push:
  parallel: true
  commands:
    packages-audit:
      tags: frontend security
      run: yarn npm audit
    eslint:
      exclude: *eslint-exclude
      run: yarn check-eslint {push_files}
    prettier:
      exclude: 'yarn\.lock$|\.mdc$'
      run: yarn check-prettier {push_files}
    cspell:
      exclude: *yarn-lock
      run: yarn check-cspell {push_files}

# CI-specific hooks that work better in detached HEAD
ci:
  parallel: true
  commands:
    packages-audit:
      tags: frontend security
      run: yarn npm audit
    eslint:
      exclude: *eslint-exclude
      run: yarn check-eslint-all
    prettier:
      exclude: 'yarn\.lock$|\.mdc$'
      run: yarn check-prettier-all
    cspell:
      exclude: *yarn-lock
      run: yarn check-cspell-all
    test:
      run: yarn test
    build-trpc-service:
      tags: backend build
      run: yarn workspace @some-name/trpc-service build
    build-vite-mantine:
      tags: frontend build
      run: yarn workspace @some-name/vite-mantine-vanilla-extract build

# Development testing hooks
test-dev:
  parallel: false
  commands:
    start-trpc-service:
      tags: backend dev
      run: yarn workspace @some-name/trpc-service start
    dev-vite-mantine:
      tags: frontend dev
      run: yarn workspace @some-name/vite-mantine-vanilla-extract dev
    preview-vite-mantine:
      tags: frontend preview
      run: yarn workspace @some-name/vite-mantine-vanilla-extract preview
